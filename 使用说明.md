[TOC]

**å»ºè®®ç”¨typoraé˜…è¯»**

# å‡†å¤‡å·¥ä½œ

## 1.æ‰§è¡Œsqlè„šæœ¬ç”Ÿæˆæ•°æ®åº“

- **åˆ›å»ºä¸€ä¸ªæ•°æ®åº“**

<img src="ä½¿ç”¨è¯´æ˜.assets/image-20201202232823596.png" alt="image-20201202232823596" style="zoom:67%;" />

- **æ‰§è¡Œsqlè„šæœ¬**

<img src="ä½¿ç”¨è¯´æ˜.assets\image-20201202233110637.png" alt="image-20201202233110637" style="zoom:50%;" /><img src="ä½¿ç”¨è¯´æ˜.assets\image-20201202231925164.png" alt="image-20201202231925164" style="zoom:50%;" />

## 2.é…ç½®æ•°æ®åº“è¿æ¥

- resourcesç›®å½•ä¸‹ï¼Œapplication.ymlæ–‡ä»¶ä¸­é…ç½®ç”¨æˆ·åã€å¯†ç ã€urlï¼Œé¡ºä¾¿é…ç½®æœåŠ¡å™¨å¯åŠ¨ç«¯å£

<img src="ä½¿ç”¨è¯´æ˜.assets\image-20201202234015024.png" alt="image-20201202234015024" style="zoom:50%;" />

## 3.ä¸‹è½½ä¾èµ–

- æ‰“å¼€pom.xmlï¼Œç‚¹å‡»Import Changes

![image-20201202234953090](ä½¿ç”¨è¯´æ˜.assets\image-20201202234953090.png)

# é¡¹ç›®ç›®å½•ç»“æ„

<img src="ä½¿ç”¨è¯´æ˜.assets/image-20201203103638686.png" alt="image-20201203103638686" style="zoom:67%;" />

- Javaç±»ç›®å½•å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒPsolApplicationä¸ºå¯åŠ¨ç±»

- resourcesç›®å½•ä¸ºé™æ€èµ„æºç›®å½•ï¼Œä¸‹å±staticç›®å½•æ”¾ç½®é™æ€èµ„æºæ–‡ä»¶ï¼Œtemplatesç›®å½•æ”¾ç½®æ¨¡æ¿æ–‡ä»¶ï¼Œapplication.ymlä¸ºé¡¹ç›®é…ç½®æ–‡ä»¶

- pom.xmlä¸ºä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œå¦‚ä»¥ä¸‹æ–¹å¼æ·»åŠ ä¾èµ–

  ```xml
  <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <scope>runtime</scope>
      <version>8.0.11</version>
  </dependency>
  ```

# ä½¿ç”¨è¯´æ˜

## 1.MyBatisPlusä»æ•°æ®è¡¨è‡ªåŠ¨ç”Ÿæˆä»£ç 

1ï¼‰æ•°æ®åº“ä¸­å»ºç«‹å®ä½“ç±»æ•°æ®è¡¨

![image-20201203111227115](ä½¿ç”¨è¯´æ˜.assets/image-20201203111227115.png)

2ï¼‰MybatisPlusGeneratorç±»ä¸­å¯¹ä»£ç çš„ç”Ÿæˆè¿›è¡Œé…ç½®ï¼Œåœ¨utilsåŒ…ä¸‹

```java
public class MybatisPlusGenerator {
    public static void main(String[] args) {
        AutoGenerator mpg = new AutoGenerator();

        GlobalConfig gc = new GlobalConfig();
        String projectPath = System.getProperty("user.dir");
        gc.setOutputDir(projectPath+"/src/main/java");
        gc.setOpen(false);
        gc.setFileOverride(true);//å†æ¬¡ç”Ÿæˆæ–‡ä»¶æ˜¯å¦è¦†ç›–ä¹‹å‰æ–‡ä»¶
        gc.setServiceName("%sService");//Serviceç±»å‘½åæ–¹å¼ï¼ŒServiceä¸ºæ¥å£ç±»
        gc.setMapperName("%sMapper");//Mapperç±»å‘½åæ–¹å¼
        gc.setXmlName("%sMapper");//Mapperå¯¹åº”xmlæ–‡ä»¶å‘½åæ–¹å¼
        gc.setServiceImplName("%sServiceImpl");//Serviceå®ç°ç±»å‘½åæ–¹å¼
        gc.setControllerName("%sController");//å®ä½“ç±»çš„Controllerç”Ÿæˆæ–¹å¼ï¼Œä¸€èˆ¬ä¸éœ€è¦ï¼Œåæ–‡é…ç½®ä¸ç”ŸæˆControllerç±»
        gc.setDateType(DateType.ONLY_DATE);
        gc.setSwagger2(true);//æ”¯æŒswagger2
        mpg.setGlobalConfig(gc);


        DataSourceConfig dsc = new DataSourceConfig();
        // æ•°æ®åº“é…ç½®,ä¿®æ”¹æˆè‡ªå·±çš„urlï¼Œç”¨æˆ·åå¯†ç 
        dsc.setUrl("jdbc:mysql://localhost:3306/psol?useSSL=false&useUnicode=true&characterEncoding=utf-8&serverTimezone=UTC");
        dsc.setDriverName("com.mysql.cj.jdbc.Driver");
        dsc.setUsername("root");
        dsc.setPassword("123456");
        dsc.setDbType(DbType.MYSQL);
        mpg.setDataSource(dsc);

        PackageConfig pc = new PackageConfig();
        pc.setModuleName("psol");
        pc.setParent("org.orz");
        pc.setEntity("model");//é…ç½®å®ä½“ç±»åŒ…å
        pc.setMapper("mapper");//é…ç½®Mapperç±»åŒ…å
        pc.setService("service");//é…ç½®Serviceç±»åŒ…å
        pc.setController("controller");//é…ç½®Controllerç±»åŒ…å
        mpg.setPackageInfo(pc);

        StrategyConfig strategy = new StrategyConfig();
        /*
            é…ç½®éœ€è¦ç”Ÿæˆä»£ç çš„è¡¨åï¼Œå¤šä¸ªè¡¨ç”¨é€—å·éš”å¼€
            strategy.setInclude("table1","table2");
        */
        strategy.setInclude("user","role_path");
        strategy.setNaming(NamingStrategy.underline_to_camel);
        strategy.setColumnNaming(NamingStrategy.underline_to_camel);
        strategy.setEntityLombokModel(true);//å®ä½“ç±»åº”ç”¨lombokæ¨¡å¼
        strategy.setRestControllerStyle(true);
        mpg.setStrategy(strategy);

        TemplateConfig tmp = new TemplateConfig();
        // ä¸ç”ŸæˆControllerå’Œxmlæ–‡ä»¶
        tmp.setController("");
        tmp.setXml(null);

        mpg.setTemplate(tmp);
        mpg.execute();
    }
}
```

â€‹	å¦‚æœè¦ç”Ÿæˆxmlæ–‡ä»¶ï¼Œæ³¨é‡Šæ‰è¯¥è¡Œ

```java
tmp.setXml(null);
```

3) è¿è¡ŒMyBatisPlusGeneratorç”Ÿæˆä»£ç 

â€‹										<img src="ä½¿ç”¨è¯´æ˜.assets/2020-12-03112558.jpg" alt="2020-12-03112558" style="zoom:67%;" />

## 2.å®ä½“ç±»ä½¿ç”¨Lombokæ³¨é‡Šå‡å°‘ä»£ç 

æ›´è¯¦ç»†ç”¨æ³•è¯·çœ‹[LombokæŒ‡å—](https://mp.weixin.qq.com/s/DZn4I0H_kKNzweK_pUlDIA)

1ï¼‰**@Getter å’Œ @Setter**

â€‹		æ³¨é‡Šåœ¨ç±»ä¸Šï¼Œä¼šä¸ºç±»ä¸­æ‰€æœ‰å­—æ®µç”ŸæˆGetterå’ŒSetteræ–¹æ³•

```java
@Getter
@Setter
public class Path {
    String url;
    List<String> roles;
}
```

â€‹		æ³¨é‡Šåœ¨å­—æ®µä¸Šä¼šä¸ºè¯¥å­—æ®µç”ŸæˆGetterå’ŒSetteræ–¹æ³•

```java
public class Path {
    String url;
    @Getter
    @Setter
    List<String> roles;
}
```

2ï¼‰ **@NoArgsConstructor å’Œ @AllArgsConstructor**

â€‹		æ³¨é‡Šåœ¨ç±»ä¸Šï¼Œä¸ºç±»ç”Ÿæˆæ— å‚æ„é€ å’Œéœ€è¦å…¨éƒ¨å‚æ•°çš„æ„é€ å‡½æ•°

3ï¼‰ **@ToString**

â€‹		æ³¨é‡Šåœ¨ç±»ä¸Šï¼Œä¸ºç±»ç”ŸæˆtoString()æ–¹æ³•

4ï¼‰@**Data** (**å¼ºçƒˆæ¨èä½¿ç”¨å™¢ï¼ï¼ï¼**)

â€‹		ç­‰ä»·ä¸åŒæ—¶ä½¿ç”¨**@ToString **ã€**@Getter å’Œ @Setter**ã€ **@NoArgsConstructor å’Œ @AllArgsConstructor**

â€‹		ç±»åŠ ä¸Šä¸€ä¸ª@Dataï¼Œç›´æ¥æœåŠ¡åˆ°å®¶ï¼ˆæ³ªç›®ğŸ˜­ï¼‰

```java
@Data
public class Path {
    String url;
    List<String> roles;

    public void addRole(String role) {
        this.roles.add(role);
    }
}
```

## 3.MybatisPlusçš„CRUDæ“ä½œ

### 1) å®šä¹‰å’Œä½¿ç”¨æ­¥éª¤

ä»¥Userå®ä½“ç±»ä¸ºä¾‹

**step1ï¼š**åœ¨UserServiceImplç±»ä¸­æ³¨å…¥UserMapper

```java
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    @Autowired
    UserMapper userMapper;
}
```

**step2:**  åœ¨UserServiceImplç±»ä¸­å®šä¹‰CRUDæ–¹æ³•

```java
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    @Autowired
    UserMapper userMapper;

    public User loadByUsername(String username) {
        QueryWrapper<User> wrapper = new QueryWrapper<>();
        wrapper.eq("username", username);
        return userMapper.selectOne(wrapper);
    }
}
```

**step3ï¼š** åœ¨controllerä¸­æ³¨å…¥UserServiceImplï¼Œè°ƒç”¨æ–¹æ³•

```java
@RestController
public class TestController {
    @Autowired
    UserServiceImpl userService;

    @GetMapping("/user")
    User test(){
        User user = userService.loadByUsername("admin");
        return user;
    }
}
```

### 2) ä½¿ç”¨Mapperè¿›è¡ŒCRUDæ“ä½œ

ä½¿ç”¨å‰å…ˆåœ¨å½“å‰æ–‡ä»¶ä¸‹æ³¨å…¥å¯¹åº”mapperï¼ˆä»¥UserMapperä¸ºä¾‹ï¼‰

```java
@Autowired
UserMapper userMapper;
```

#### å¢åŠ ï¼ˆCreateï¼‰

```java
@SpringBootTest
class PsolApplicationTests {
    @Autowired
    UserMapper userMapper;
    /**
     * ä½¿ç”¨insertæ–¹æ³•ï¼Œ æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°
     */
    @Test
    void test() {
        User user = new User();
        user.setUsername("user1");
        user.setRole("ROLE_user");
        userMapper.insert(user);
    }
}
```

#### æŸ¥è¯¢ï¼ˆRetrieveï¼‰

```java
/**
 * selectByMapæ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªColumnMapï¼Œè¿”å›å€¼ä¸ºlistæ•°ç»„
 */
@Test
void test1() {
    Map<String, Object> map = new HashMap<>();
    map.put("username","admin");
    List<User> users;
    users = userMapper.selectByMap(map);
    System.out.println(users);
}
```

```java
/**
 * selectByIdå’ŒselectByIdsï¼Œé€šè¿‡IdæŸ¥è¯¢ï¼Œè¿”å›å•ä¸ªå’Œå¤šä¸ªå¯¹è±¡
 */
@Test
void test2() {
    User user = userMapper.selectById(1);
    System.out.println(user);
    List<Integer> ids = new ArrayList<>();
    ids.add(2);
    ids.add(3);
    List<User> users = userMapper.selectBatchIds(ids);
    System.out.println(users);
}
```

```java
/**
 *  selectList å’Œ selectOneï¼Œè¿”å›å¤šæ¡å’Œå•æ¡ï¼Œé€šè¿‡QueryWrapperæŸ¥è¯¢
 */
@Test
void test3() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    /*
     * eq ç­‰äº =
     * ne ä¸ç­‰äº <>
     * gt å¤§äº >
     * like like("name", "ç‹")--->name like '%ç‹%'
     * isNull isNull("name")
     * æ›´å¤šè§ https://mybatis.plus/guide/wrapper.html#abstractwrapper
     */
    wrapper.eq("username", "admin");
    List<User> users = userMapper.selectList(wrapper);
    System.out.println(users);
    User user = userMapper.selectOne(wrapper);
    System.out.println(user);
}
```

```java
/**
 * selectCountæ–¹æ³•ï¼Œç”¨QueryWrapperæŸ¥è¯¢ï¼Œè¿”å›ç¬¦åˆæ¡ä»¶çš„è®°å½•æ¡æ•°
 */
@Test
void test4() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    wrapper.eq("username", "admin");
    Integer n = userMapper.selectCount(wrapper);
    System.out.println(n);
}
```

#### ä¿®æ”¹ï¼ˆUpdateï¼‰

```java
/**
 * updateæ–¹æ³•æ‰¹é‡æ›´æ–°
 * wrapperä¸­å­˜å‚¨éœ€è¦æ›´æ”¹çš„è®°å½•çš„ç­›é€‰æ¡ä»¶
 * æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­è®¾ç½®éœ€è¦æ›´æ”¹çš„å­—æ®µçš„å€¼
 */
@Test
void test5() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    wrapper.eq("activate", false);
    User user = new User();
    user.setActivate(true);
    userMapper.update(user,wrapper);
}
```

```java
/**
 * update æ–¹æ³•æ›´æ–°å•æ¡è®°å½•
 */
@Test
void test6() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    wrapper.eq("username", "user1");
    User user = userMapper.selectOne(wrapper);
    userMapper.updateById(user);
}
```

#### åˆ é™¤ï¼ˆDeleteï¼‰

```java
/**
 * easy huh
 */
@Test
void test7() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    wrapper.eq("username", "user1");
    userMapper.delete(wrapper);
    Map<String, Object> map = new HashMap<>();
    map.put("username","admin");
    userMapper.deleteByMap(map);
    userMapper.deleteById(1);
}
```

### 3) ServiceImplæœåŠ¡å®ç°ç±»è‡ªå¸¦çš„CRUDå‡½æ•°

```java
@Autowired
UserServiceImpl userService;
```

```java
@Test
void test8() {
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    wrapper.eq("activate", false);

    // æŸ¥è¯¢å•æ¡
    User user = userService.getOne(wrapper);
    User user1 = userService.getById(1);
    //æŸ¥è¯¢å¤šæ¡
    List<Map<String, Object>> list = userService.listMaps();
    List<Map<String, Object>> list1 = userService.listMaps(wrapper);
    List<User> users = userService.list();
    List<User> users1 = userService.list(wrapper);
    // æ›´æ–°å•æ¡
    userService.update(user, wrapper);
    // saveå•æ¡
    userService.save(user);
    // saveå¤šæ¡
    userService.saveBatch(users);
    // ä¿å­˜æˆ–æ›´æ–°
    userService.saveOrUpdate(user, wrapper);
    // æ»¡è¶³æ¡ä»¶åˆ é™¤
    userService.remove(wrapper);
    userService.removeById(1);
}
```

## 4.Swagger2æ³¨é‡Šç”¨äºç”Ÿæˆæ¥å£æ–‡æ¡£

è®¿é—® **/doc.html**è°ƒè¯•å’ŒæŸ¥çœ‹æ¥å£ï¼ï¼ï¼ï¼

![image-20201203152554507](ä½¿ç”¨è¯´æ˜.assets/image-20201203152554507.png)

<img src="ä½¿ç”¨è¯´æ˜.assets/image-20201203153749151.png" alt="image-20201203153749151" style="zoom:50%;" />

![image-20201203153907738](ä½¿ç”¨è¯´æ˜.assets/image-20201203153907738.png)

# é…ç½®ä¿¡æ¯

## 1.æƒé™é…ç½®

- userè¡¨ä¸­roleå­—æ®µé…ç½®ç”¨æˆ·çš„æƒé™ï¼Œroleå­—æ®µè¦ä»¥   **ROLE_**    å¼€å¤´

![image-20201203154350113](ä½¿ç”¨è¯´æ˜.assets/image-20201203154350113.png)

- role_pathè¡¨ä¸­é…ç½®ç›¸åº”æƒé™å¯ä»¥è®¿é—®çš„è·¯å¾„

![image-20201203154519073](ä½¿ç”¨è¯´æ˜.assets/image-20201203154519073.png)

## 2.ç™»é™†æ¥å£

![image-20201203154752491](ä½¿ç”¨è¯´æ˜.assets/image-20201203154752491.png)

- ç”¨æˆ·æœªç™»å½•åº”è¯¥è¢«é‡å®šå‘è·¯å¾„   **/login** ï¼Œå¤„ç†   **/login**  çš„controlleråº”è¯¥è¿”å›ä¸€ä¸ªç™»é™†é¡µé¢æˆ–è€…æç¤ºç™»å½•çš„ä¿¡æ¯ï¼Œcontrollerè¿˜æœªå®ç°ã€‚
- ç”¨æˆ·ç™»å½•åˆ™å¾€  **/doLogin** æ¥å£å‘é€postè¯·æ±‚ï¼Œéœ€è¦ **username**å’Œ **password**ä¸¤ä¸ªè¯·æ±‚å‚æ•°ã€‚è¯¥æ¥å£å·²ç»ç”±SpringSecutityå®ç°ã€‚
- ç™»å‡ºæ¥å£ä¸º  **/logout** ï¼Œç™»å‡ºåè‡ªåŠ¨æ¸…é™¤ç”¨æˆ·ä¿¡æ¯ã€‚è¯¥æ¥å£å·²ç»ç”±SpringSecutityå®ç°ã€‚

- **SecurityConfig**ä¸ºSpringSecurityçš„é…ç½®ç±»ï¼Œé‡Œé¢å¯ä»¥ä¿®æ”¹é…ç½®ä¿¡æ¯ã€‚